window=window||global,window.layalib||(window.layalib=function(f,i){(window._layalibs||(window._layalibs=[])).push({f:f,i:i})}),window.layalib(function(window,document,Laya){Laya.un,Laya.uns;var __static=Laya.static,__class=Laya.class,__getset=Laya.getset,Browser=(Laya.__newvec,laya.utils.Browser),EventDispatcher=(laya.events.Event,laya.events.EventDispatcher),HTMLImage=laya.resource.HTMLImage,Handler=laya.utils.Handler,Input=laya.display.Input,Loader=laya.net.Loader,LocalStorage=laya.net.LocalStorage,Matrix=laya.maths.Matrix,Render=laya.renders.Render,RunDriver=laya.utils.RunDriver,SoundChannel=laya.media.SoundChannel,SoundManager=laya.media.SoundManager,URL=(laya.display.Stage,laya.net.URL),Utils=laya.utils.Utils,MiniFileMgr=(function(){function MiniLocation(){}__class(MiniLocation,"laya.wx.mini.MiniLocation"),MiniLocation.__init__=function(){MiniAdpter.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition,MiniAdpter.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition,MiniAdpter.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch},MiniLocation.getCurrentPosition=function(success,error,options){var paramO;(paramO={}).success=function(res){null!=success&&success(res)},paramO.fail=error,MiniAdpter.window.wx.getLocation(paramO)},MiniLocation.watchPosition=function(success,error,options){var curWatchO;return MiniLocation._curID++,(curWatchO={}).success=success,curWatchO.error=error,MiniLocation._watchDic[MiniLocation._curID]=curWatchO,Laya.systemTimer.loop(1e3,null,MiniLocation._myLoop),MiniLocation._curID},MiniLocation.clearWatch=function(id){delete MiniLocation._watchDic[id],MiniLocation._hasWatch()||Laya.systemTimer.clear(null,MiniLocation._myLoop)},MiniLocation._hasWatch=function(){var key;for(key in MiniLocation._watchDic)if(MiniLocation._watchDic[key])return!0;return!1},MiniLocation._myLoop=function(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError)},MiniLocation._mySuccess=function(res){var key,rst={};for(key in rst.coords=res,rst.timestamp=Browser.now(),MiniLocation._watchDic)MiniLocation._watchDic[key].success&&MiniLocation._watchDic[key].success(rst)},MiniLocation._myError=function(res){var key;for(key in MiniLocation._watchDic)MiniLocation._watchDic[key].error&&MiniLocation._watchDic[key].error(res)},MiniLocation._watchDic={},MiniLocation._curID=0}(),function(){function MiniFileMgr(){}return __class(MiniFileMgr,"laya.wx.mini.MiniFileMgr"),MiniFileMgr.isLocalNativeFile=function(url){for(var i=0,sz=MiniAdpter.nativefiles.length;i<sz;i++)if(-1!=url.indexOf(MiniAdpter.nativefiles[i]))return!0;return!1},MiniFileMgr.getFileInfo=function(fileUrl){var fileNativePath=fileUrl,fileObj=MiniFileMgr.filesListObj[fileNativePath];return null==fileObj?null:fileObj},MiniFileMgr.read=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType){var fileUrl;void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),fileUrl=""==readyUrl||-1==readyUrl.indexOf("http://")&&-1==readyUrl.indexOf("https://")?filePath:MiniFileMgr.getFileNativePath(filePath),fileUrl=URL.getAdptedFilePath(fileUrl),MiniFileMgr.fs.readFile({filePath:fileUrl,encoding:encoding,success:function(data){null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&""!=readyUrl?MiniFileMgr.downFiles(readyUrl,encoding,callBack,readyUrl,isSaveFile,fileType):null!=callBack&&callBack.runWith([1])}})},MiniFileMgr.downFiles=function(fileUrl,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascii"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode?MiniFileMgr.readFile(data.tempFilePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear):403===data.statusCode?null!=callBack&&callBack.runWith([0,fileUrl]):null!=callBack&&callBack.runWith([1,data])},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}).onProgressUpdate(function(data){null!=callBack&&callBack.runWith([2,data.progress])})},MiniFileMgr.readFile=function(filePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===fileType&&(fileType=""),void 0===isAutoClear&&(isAutoClear=!0),filePath=URL.getAdptedFilePath(filePath),MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function(data){-1!=filePath.indexOf("http://")||-1!=filePath.indexOf("https://")?(MiniAdpter.autoCacheFile||isSaveFile)&&MiniFileMgr.copyFile(filePath,readyUrl,callBack,encoding,isAutoClear):null!=callBack&&callBack.runWith([0,data])},fail:function(data){data&&null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downOtherFiles=function(fileUrl,callBack,readyUrl,isSaveFile,isAutoClear){void 0===readyUrl&&(readyUrl=""),void 0===isSaveFile&&(isSaveFile=!1),void 0===isAutoClear&&(isAutoClear=!0),MiniFileMgr.wxdown({url:fileUrl,success:function(data){200===data.statusCode?(MiniAdpter.autoCacheFile||isSaveFile)&&-1==readyUrl.indexOf("qlogo.cn")&&-1==readyUrl.indexOf(".php")?MiniFileMgr.copyFile(data.tempFilePath,readyUrl,callBack,"",isAutoClear):null!=callBack&&callBack.runWith([0,data.tempFilePath]):null!=callBack&&callBack.runWith([1,data])},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="ascii"),window.navigator.userAgent.indexOf("MiniGame")<0?Laya.loader.load(fileUrl,callBack):"image"==fileType||"sound"==fileType?MiniFileMgr.downOtherFiles(fileUrl,callBack,fileUrl,!0,!1):MiniFileMgr.downFiles(fileUrl,encoding,callBack,fileUrl,!0,fileType,!1)},MiniFileMgr.copyFile=function(tempFilePath,readyUrl,callBack,encoding,isAutoClear){void 0===encoding&&(encoding=""),void 0===isAutoClear&&(isAutoClear=!0);var temp=tempFilePath.split("/"),tempFileName=temp[temp.length-1],fileObj=MiniFileMgr.getFileInfo(readyUrl),saveFilePath=MiniFileMgr.getFileNativePath(tempFileName),fileUseSize=MiniFileMgr.getCacheUseSize();fileObj?fileObj.readyUrl!=readyUrl?MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&fileUseSize+4194304+data.size>=52428800&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.deleteFile(tempFileName,readyUrl,callBack,encoding,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}}):null!=callBack&&callBack.runWith([0]):MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function(data){isAutoClear&&fileUseSize+4194304+data.size>=52428800&&(data.size>MiniAdpter.minClearSize&&(MiniAdpter.minClearSize=data.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function(data2){MiniFileMgr.onSaveFile(readyUrl,tempFileName,!0,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.onClearCacheRes=function(){var memSize=MiniAdpter.minClearSize,tempFileListArr=[];for(var key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);MiniFileMgr.sortOn(tempFileListArr,"times",16);for(var clearSize=0,i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];if(clearSize>=memSize)break;clearSize+=fileObj.size,MiniFileMgr.deleteFile("",fileObj.readyUrl)}},MiniFileMgr.sortOn=function(array,name,options){return void 0===options&&(options=0),16==options?array.sort(function(a,b){return a[name]-b[name]}):18==options?array.sort(function(a,b){return b[name]-a[name]}):array.sort(function(a,b){return a[name]-b[name]})},MiniFileMgr.getFileNativePath=function(fileName){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+fileName},MiniFileMgr.deleteFile=function(tempFileName,readyUrl,callBack,encoding,fileSize){void 0===readyUrl&&(readyUrl=""),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileObj=MiniFileMgr.getFileInfo(readyUrl),deleteFileUrl=MiniFileMgr.getFileNativePath(fileObj.md5);MiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function(data){var isAdd=""!=tempFileName;if(""!=tempFileName){var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);MiniFileMgr.fs.copyFile({srcPath:tempFileName,destPath:saveFilePath,success:function(data){MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,data.size)},fail:function(data){null!=callBack&&callBack.runWith([1,data])}})}else MiniFileMgr.onSaveFile(readyUrl,tempFileName,isAdd,encoding,callBack,fileSize)},fail:function(data){}})},MiniFileMgr.deleteAll=function(){var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj)tempFileListArr.push(MiniFileMgr.filesListObj[key]);for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];MiniFileMgr.deleteFile("",fileObj.readyUrl)}laya.wx.mini.MiniFileMgr.filesListObj&&laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize&&(laya.wx.mini.MiniFileMgr.filesListObj.fileUsedSize=0),laya.wx.mini.MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)},MiniFileMgr.onSaveFile=function(readyUrl,md5Name,isAdd,encoding,callBack,fileSize){void 0===isAdd&&(isAdd=!0),void 0===encoding&&(encoding=""),void 0===fileSize&&(fileSize=0);var fileurlkey=readyUrl;if(null==MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),isAdd){MiniFileMgr.getFileNativePath(md5Name);MiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:fileSize,times:Browser.now(),encoding:encoding},MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)+fileSize,MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!0),null!=callBack&&callBack.runWith([0])}else if(MiniFileMgr.filesListObj[fileurlkey]){var deletefileSize=parseInt(MiniFileMgr.filesListObj[fileurlkey].size);MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)-deletefileSize,delete MiniFileMgr.filesListObj[fileurlkey],MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),!1),null!=callBack&&callBack.runWith([0])}},MiniFileMgr.writeFilesList=function(fileurlkey,filesListStr,isAdd){var listFilesPath=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:listFilesPath,encoding:"utf8",data:filesListStr,success:function(data){},fail:function(data){}}),!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&wx.postMessage({url:fileurlkey,data:MiniFileMgr.filesListObj[fileurlkey],isLoad:"filenative",isAdd:isAdd})},MiniFileMgr.getCacheUseSize=function(){return MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize?MiniFileMgr.filesListObj.fileUsedSize:0},MiniFileMgr.existDir=function(dirPath,callBack){MiniFileMgr.fs.mkdir({dirPath:dirPath,success:function(data){null!=callBack&&callBack.runWith([0,{data:JSON.stringify({})}])},fail:function(data){-1!=data.errMsg.indexOf("file already exists")?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",callBack):null!=callBack&&callBack.runWith([1,data])}})},MiniFileMgr.readSync=function(filePath,encoding,callBack,readyUrl){void 0===encoding&&(encoding="ascill"),void 0===readyUrl&&(readyUrl="");var filesListStr,fileUrl=MiniFileMgr.getFileNativePath(filePath);try{filesListStr=MiniFileMgr.fs.readFileSync(fileUrl,encoding),null!=callBack&&callBack.runWith([0,{data:filesListStr}])}catch(error){null!=callBack&&callBack.runWith([1])}},MiniFileMgr.setNativeFileDir=function(value){MiniFileMgr.fileNativeDir=wx.env.USER_DATA_PATH+value},MiniFileMgr.filesListObj={},MiniFileMgr.fileNativeDir=null,MiniFileMgr.fileListName="layaairfiles.txt",MiniFileMgr.ziyuFileData={},MiniFileMgr.ziyuFileTextureData={},MiniFileMgr.loadPath="",MiniFileMgr.DESCENDING=2,MiniFileMgr.NUMERIC=16,__static(MiniFileMgr,["fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),MiniFileMgr}()),MiniLocalStorage=function(){function MiniLocalStorage(){}return __class(MiniLocalStorage,"laya.wx.mini.MiniLocalStorage"),MiniLocalStorage.__init__=function(){MiniLocalStorage.items=MiniLocalStorage},MiniLocalStorage.setItem=function(key,value){try{wx.setStorageSync(key,value)}catch(error){wx.setStorage({key:key,data:value})}},MiniLocalStorage.getItem=function(key){return wx.getStorageSync(key)},MiniLocalStorage.setJSON=function(key,value){MiniLocalStorage.setItem(key,value)},MiniLocalStorage.getJSON=function(key){return MiniLocalStorage.getItem(key)},MiniLocalStorage.removeItem=function(key){wx.removeStorageSync(key)},MiniLocalStorage.clear=function(){wx.clearStorageSync()},MiniLocalStorage.getStorageInfoSync=function(){try{var res=wx.getStorageInfoSync();return console.log(res.keys),console.log(res.currentSize),console.log(res.limitSize),res}catch(e){}return null},MiniLocalStorage.support=!0,MiniLocalStorage.items=null,MiniLocalStorage}(),MiniImage=(function(){function MiniVideo(width,height){this.videoend=!1,this.videourl="",this.videoElement=null,this.onPlayFunc=null,this.onEndedFunC=null,this._duration=NaN,this.position=NaN,void 0===width&&(width=320),void 0===height&&(height=240),this.videoElement=MiniAdpter.window.wx.createVideo({width:width,height:height,autoplay:!0})}__class(MiniVideo,"laya.wx.mini.MiniVideo");var __proto=MiniVideo.prototype;__proto.on=function(eventType,ths,callBack){"loadedmetadata"==eventType?(this.onPlayFunc=callBack.bind(ths),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==eventType&&(this.onEndedFunC=callBack.bind(ths),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)},__proto.onTimeUpdateFunc=function(data){this.position=data.position,this._duration=data.duration},__proto.onPlayFunction=function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()},__proto.onEndedFunction=function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())},__proto.off=function(eventType,ths,callBack){"loadedmetadata"==eventType?(this.onPlayFunc=callBack.bind(ths),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==eventType&&(this.onEndedFunC=callBack.bind(ths),this.videoElement.offEnded=this.onEndedFunction.bind(this))},__proto.load=function(url){this.videoElement&&(this.videoElement.src=url)},__proto.play=function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())},__proto.pause=function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())},__proto.size=function(width,height){this.videoElement&&(this.videoElement.width=width,this.videoElement.height=height)},__proto.destroy=function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null},__proto.reload=function(){this.videoElement&&(this.videoElement.src=this.videourl)},__getset(0,__proto,"duration",function(){return this._duration}),__getset(0,__proto,"paused",function(){return!!this.videoElement&&this.videoElement.paused}),__getset(0,__proto,"loop",function(){return!!this.videoElement&&this.videoElement.loop},function(value){this.videoElement&&(this.videoElement.loop=value)}),__getset(0,__proto,"currentTime",function(){return this.videoElement?this.videoElement.initialTime:0},function(value){this.videoElement&&(this.videoElement.initialTime=value)}),__getset(0,__proto,"ended",function(){return this.videoend}),__getset(0,__proto,"muted",function(){return!!this.videoElement&&this.videoElement.muted},function(value){this.videoElement&&(this.videoElement.muted=value)}),__getset(0,__proto,"videoWidth",function(){return this.videoElement?this.videoElement.width:0}),__getset(0,__proto,"videoHeight",function(){return this.videoElement?this.videoElement.height:0}),__getset(0,__proto,"playbackRate",function(){return this.videoElement?this.videoElement.playbackRate:0},function(value){this.videoElement&&(this.videoElement.playbackRate=value)}),__getset(0,__proto,"x",function(){return this.videoElement?this.videoElement.x:0},function(value){this.videoElement&&(this.videoElement.x=value)}),__getset(0,__proto,"y",function(){return this.videoElement?this.videoElement.y:0},function(value){this.videoElement&&(this.videoElement.y=value)}),__getset(0,__proto,"currentSrc",function(){return this.videoElement.src}),MiniVideo.__init__=function(){laya.device.media.Video=MiniVideo}}(),function(){function MiniImage(){}return __class(MiniImage,"laya.wx.mini.MiniImage"),MiniImage.prototype._loadImage=function(url){if(MiniAdpter.isZiYu)MiniImage.onCreateImage(url,this,!0);else{var isTransformUrl=!1;if(MiniFileMgr.isLocalNativeFile(url)){if(-1==url.indexOf("http://usr/")&&(-1!=url.indexOf("http://")||-1!=url.indexOf("https://")))if(""!=MiniFileMgr.loadPath)url=url.split(MiniFileMgr.loadPath)[1];else{var tempStr=""!=URL.rootPath?URL.rootPath:URL._basePath,tempUrl=url;""!=tempStr&&(url=url.split(tempStr)[1]),url||(url=tempUrl)}if(MiniAdpter.subNativeFiles&&0==MiniAdpter.subNativeheads.length)for(var key in MiniAdpter.subNativeFiles){var tempArr=MiniAdpter.subNativeFiles[key];MiniAdpter.subNativeheads=MiniAdpter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++)MiniAdpter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa]}if(MiniAdpter.subNativeFiles&&-1!=url.indexOf("/")){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&-1!=MiniAdpter.subNativeheads.indexOf(curfileHead)){var newfileHead=MiniAdpter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead)}}}else isTransformUrl=!0,url=URL.formatURL(url);MiniFileMgr.getFileInfo(url)?MiniImage.onCreateImage(url,this,!isTransformUrl):-1!=url.indexOf("http://usr/")||-1==url.indexOf("http://")&&-1==url.indexOf("https://")?MiniImage.onCreateImage(url,this,!0):MiniAdpter.isZiYu?MiniImage.onCreateImage(url,this,!0):MiniFileMgr.downOtherFiles(url,new Handler(MiniImage,MiniImage.onDownImgCallBack,[url,this]),url)}},MiniImage.onDownImgCallBack=function(sourceUrl,thisLoader,errorCode,tempFilePath){void 0===tempFilePath&&(tempFilePath=""),errorCode?thisLoader.onError(null):MiniImage.onCreateImage(sourceUrl,thisLoader,!1,tempFilePath)},MiniImage.onCreateImage=function(sourceUrl,thisLoader,isLocal,tempFilePath){var fileNativeUrl,image;if(void 0===isLocal&&(isLocal=!1),void 0===tempFilePath&&(tempFilePath=""),MiniAdpter.autoCacheFile)if(isLocal)if(MiniAdpter.isZiYu){var tempUrl=URL.formatURL(sourceUrl);fileNativeUrl=MiniFileMgr.ziyuFileTextureData[tempUrl]?MiniFileMgr.ziyuFileTextureData[tempUrl]:sourceUrl}else fileNativeUrl=sourceUrl;else if(""!=tempFilePath)fileNativeUrl=tempFilePath;else{var fileMd5Name=MiniFileMgr.getFileInfo(sourceUrl).md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name)}else fileNativeUrl=isLocal?sourceUrl:tempFilePath;function clear(){var img=thisLoader._imgCache[fileNativeUrl];img&&(img.onload=null,img.onerror=null,delete thisLoader._imgCache[fileNativeUrl])}null==thisLoader._imgCache&&(thisLoader._imgCache={});var onerror=function(){clear(),thisLoader.event("error","Load image failed")};if("nativeimage"==thisLoader._type){var onload=function(){clear(),thisLoader.onLoaded(image)};(image=new Browser.window.Image).crossOrigin="",image.onload=onload,image.onerror=onerror,image.src=fileNativeUrl,thisLoader._imgCache[fileNativeUrl]=image}else{var imageSource=new Browser.window.Image;onload=function(){(image=HTMLImage.create(imageSource.width,imageSource.height)).loadImageSource(imageSource,!0),image._setCreateURL(fileNativeUrl),clear(),thisLoader.onLoaded(image)},imageSource.crossOrigin="",imageSource.onload=onload,imageSource.onerror=onerror,imageSource.src=fileNativeUrl,thisLoader._imgCache[fileNativeUrl]=imageSource}},MiniImage}()),MiniInput=function(){function MiniInput(){}return __class(MiniInput,"laya.wx.mini.MiniInput"),MiniInput._createInputElement=function(){Input._initInput(Input.area=Browser.createElement("textarea")),Input._initInput(Input.input=Browser.createElement("input")),Input.inputContainer=Browser.createElement("div"),Input.inputContainer.style.position="absolute",Input.inputContainer.style.zIndex=1e5,Browser.container.appendChild(Input.inputContainer),Input.inputContainer.setPos=function(x,y){Input.inputContainer.style.left=x+"px",Input.inputContainer.style.top=y+"px"},Laya.stage.on("resize",null,MiniInput._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(res){window.dispatchEvent&&window.dispatchEvent("resize")}),SoundManager._soundClass=MiniSound,SoundManager._musicClass=MiniSound;var model=MiniAdpter.systemInfo.model,system=MiniAdpter.systemInfo.system;-1!=model.indexOf("iPhone")&&(Browser.onIPhone=!0,Browser.onIOS=!0,Browser.onIPad=!0,Browser.onAndroid=!1),-1==system.indexOf("Android")&&-1==system.indexOf("Adr")||(Browser.onAndroid=!0,Browser.onIPhone=!1,Browser.onIOS=!1,Browser.onIPad=!1)},MiniInput._onStageResize=function(){Laya.stage._canvasTransform.identity().scale(Browser.width/Render.canvas.width/Browser.pixelRatio,Browser.height/Render.canvas.height/Browser.pixelRatio)},MiniInput.wxinputFocus=function(e){var _inputTarget=Input.inputElement.target;_inputTarget&&!_inputTarget.editable||(MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.showKeyboard({defaultValue:_inputTarget.text,maxLength:_inputTarget.maxChars,multiple:_inputTarget.multiline,confirmHold:!0,confirmType:_inputTarget.confirmType||"done",success:function(res){},fail:function(res){}}),MiniAdpter.window.wx.onKeyboardConfirm(function(res){var str=res?res.value:"";_inputTarget._restrictPattern&&(str=str.replace(/\u2006|\x27/g,""),_inputTarget._restrictPattern.test(str)&&(str=str.replace(_inputTarget._restrictPattern,""))),_inputTarget.text=str,_inputTarget.event("input"),laya.wx.mini.MiniInput.inputEnter(),_inputTarget.event("confirm")}),MiniAdpter.window.wx.onKeyboardInput(function(res){var str=res?res.value:"";_inputTarget.multiline||-1==str.indexOf("\n")?(_inputTarget._restrictPattern&&(str=str.replace(/\u2006|\x27/g,""),_inputTarget._restrictPattern.test(str)&&(str=str.replace(_inputTarget._restrictPattern,""))),_inputTarget.text=str,_inputTarget.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},MiniInput.inputEnter=function(){Input.inputElement.target.focus=!1},MiniInput.wxinputblur=function(){MiniInput.hideKeyboard()},MiniInput.hideKeyboard=function(){MiniAdpter.window.wx.offKeyboardConfirm(),MiniAdpter.window.wx.offKeyboardInput(),MiniAdpter.window.wx.hideKeyboard({success:function(res){console.log("隐藏键盘")},fail:function(res){console.log("隐藏键盘出错:"+(res?res.errMsg:""))}})},MiniInput}(),MiniAdpter=function(){function MiniAdpter(){}return __class(MiniAdpter,"laya.wx.mini.MiniAdpter"),MiniAdpter.getJson=function(data){return JSON.parse(data)},MiniAdpter.enable=function(){MiniAdpter.init(Laya.isWXPosMsg,Laya.isWXOpenDataContext)},MiniAdpter.init=function(isPosMsg,isSon){void 0===isPosMsg&&(isPosMsg=!1),void 0===isSon&&(isSon=!1),MiniAdpter._inited||(MiniAdpter._inited=!0,MiniAdpter.window=window,MiniAdpter.window.hasOwnProperty("wx")&&(MiniAdpter.window.navigator.userAgent.indexOf("MiniGame")<0||(MiniAdpter.isZiYu=isSon,MiniAdpter.isPosMsgYu=isPosMsg,MiniAdpter.EnvConfig={},MiniAdpter.isZiYu||(MiniFileMgr.setNativeFileDir("/layaairGame"),MiniFileMgr.existDir(MiniFileMgr.fileNativeDir,Handler.create(MiniAdpter,MiniAdpter.onMkdirCallBack))),MiniAdpter.systemInfo=wx.getSystemInfoSync(),MiniAdpter.window.focus=function(){},Laya._getUrlPath=function(){return""},MiniAdpter.window.logtime=function(str){},MiniAdpter.window.alertTimeLog=function(str){},MiniAdpter.window.resetShareInfo=function(){},MiniAdpter.window.CanvasRenderingContext2D=function(){},MiniAdpter.window.CanvasRenderingContext2D.prototype=MiniAdpter.window.wx.createCanvas().getContext("2d").__proto__,MiniAdpter.window.document.body.appendChild=function(){},MiniAdpter.EnvConfig.pixelRatioInt=0,Browser._pixelRatio=MiniAdpter.pixelRatio(),MiniAdpter._preCreateElement=Browser.createElement,Browser.createElement=MiniAdpter.createElement,RunDriver.createShaderCondition=MiniAdpter.createShaderCondition,Utils.parseXMLFromString=MiniAdpter.parseXMLFromString,Input._createInputElement=MiniInput._createInputElement,MiniAdpter.EnvConfig.load=Loader.prototype.load,Loader.prototype.load=MiniLoader.prototype.load,Loader.prototype._loadImage=MiniImage.prototype._loadImage,LocalStorage._baseClass=MiniLocalStorage,MiniLocalStorage.__init__(),MiniAdpter.window.wx.onMessage(MiniAdpter._onMessage))))},MiniAdpter._onMessage=function(data){switch(data.type){case"changeMatrix":Laya.stage.transform.identity(),Laya.stage._width=data.w,Laya.stage._height=data.h,Laya.stage._canvasTransform=new Matrix(data.a,data.b,data.c,data.d,data.tx,data.ty);break;case"display":Laya.stage.frameRate=data.rate||"fast";break;case"undisplay":Laya.stage.frameRate="sleep"}"opendatacontext"==data.isLoad?data.url&&(MiniFileMgr.ziyuFileData[data.url]=data.atlasdata,MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl):"openJsondatacontext"==data.isLoad?data.url&&(MiniFileMgr.ziyuFileData[data.url]=data.atlasdata):"openJsondatacontextPic"==data.isLoad&&(MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl)},MiniAdpter.getUrlEncode=function(url,type){return"arraybuffer"==type?"":"utf8"},MiniAdpter.downLoadFile=function(fileUrl,fileType,callBack,encoding){void 0===fileType&&(fileType=""),void 0===encoding&&(encoding="utf8"),MiniFileMgr.getFileInfo(fileUrl)?null!=callBack&&callBack.runWith([0]):MiniFileMgr.downLoadFile(fileUrl,fileType,callBack,encoding)},MiniAdpter.remove=function(fileUrl,callBack){MiniFileMgr.deleteFile("",fileUrl,callBack,"",0)},MiniAdpter.removeAll=function(){MiniFileMgr.deleteAll()},MiniAdpter.hasNativeFile=function(fileUrl){return MiniFileMgr.isLocalNativeFile(fileUrl)},MiniAdpter.getFileInfo=function(fileUrl){return MiniFileMgr.getFileInfo(fileUrl)},MiniAdpter.getFileList=function(){return MiniFileMgr.filesListObj},MiniAdpter.exitMiniProgram=function(){MiniAdpter.window.wx.exitMiniProgram()},MiniAdpter.onMkdirCallBack=function(errorCode,data){errorCode||(MiniFileMgr.filesListObj=JSON.parse(data.data))},MiniAdpter.pixelRatio=function(){if(!MiniAdpter.EnvConfig.pixelRatioInt)try{return MiniAdpter.EnvConfig.pixelRatioInt=MiniAdpter.systemInfo.pixelRatio,MiniAdpter.systemInfo.pixelRatio}catch(error){}return MiniAdpter.EnvConfig.pixelRatioInt},MiniAdpter.createElement=function(type){var _source;if("canvas"==type)return 1==MiniAdpter.idx?MiniAdpter.isZiYu?(_source=sharedCanvas).style={}:_source=window.canvas:_source=window.wx.createCanvas(),MiniAdpter.idx++,_source;if("textarea"==type||"input"==type)return MiniAdpter.onCreateInput(type);if("div"==type){var node=MiniAdpter._preCreateElement(type);return node.contains=function(value){return null},node.removeChild=function(value){},node}return MiniAdpter._preCreateElement(type)},MiniAdpter.onCreateInput=function(type){var node=MiniAdpter._preCreateElement(type);return node.focus=MiniInput.wxinputFocus,node.blur=MiniInput.wxinputblur,node.style={},node.value=0,node.parentElement={},node.placeholder={},node.type={},node.setColor=function(value){},node.setType=function(value){},node.setFontFace=function(value){},node.addEventListener=function(value){},node.contains=function(value){return null},node.removeChild=function(value){},node},MiniAdpter.createShaderCondition=function(conditionScript){var _$this=this;return function(){return _$this[conditionScript.replace("this.","")]}},MiniAdpter.sendAtlasToOpenDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(URL.formatURL(url));if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";atlasJson.meta.image.split(",");if(atlasJson.meta&&atlasJson.meta.image)for(var toloadPics=atlasJson.meta.image.split(","),split=url.indexOf("/")>=0?"/":"\\",idx=url.lastIndexOf(split),folderPath=idx>=0?url.substr(0,idx+1):"",i=0,len=toloadPics.length;i<len;i++)toloadPics[i]=folderPath+toloadPics[i];else toloadPics=[url.replace(".json",".png")];for(i=0;i<toloadPics.length;i++){var tempAtlasPngUrl=toloadPics[i];MiniAdpter.postInfoToContext(url,tempAtlasPngUrl,atlasJson)}}},MiniAdpter.postInfoToContext=function(url,atlaspngUrl,atlasJson){var postData={frames:atlasJson.frames,meta:atlasJson.meta},textureUrl=atlaspngUrl,fileObj=MiniFileMgr.getFileInfo(URL.formatURL(atlaspngUrl));if(fileObj)var fileMd5Name=fileObj.md5,fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);else fileNativeUrl=textureUrl;if(!fileNativeUrl)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:url,atlasdata:postData,imgNativeUrl:fileNativeUrl,imgReadyUrl:textureUrl,isLoad:"opendatacontext"})},MiniAdpter.sendSinglePicToOpenDataContext=function(url){var tempTextureUrl=URL.formatURL(url),fileObj=MiniFileMgr.getFileInfo(tempTextureUrl);if(fileObj){var fileMd5Name=fileObj.md5,fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);url=tempTextureUrl}else fileNativeUrl=url;if(!fileNativeUrl)throw"获取图集的磁盘url路径不存在！";wx.postMessage({url:url,imgNativeUrl:fileNativeUrl,imgReadyUrl:url,isLoad:"openJsondatacontextPic"})},MiniAdpter.sendJsonDataToDataContext=function(url){if(!laya.wx.mini.MiniAdpter.isZiYu){var atlasJson=Loader.getRes(url);if(!atlasJson)throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";wx.postMessage({url:url,atlasdata:atlasJson,isLoad:"openJsondatacontext"})}},MiniAdpter.EnvConfig=null,MiniAdpter.window=null,MiniAdpter._preCreateElement=null,MiniAdpter._inited=!1,MiniAdpter.systemInfo=null,MiniAdpter.isZiYu=!1,MiniAdpter.isPosMsgYu=!1,MiniAdpter.autoCacheFile=!0,MiniAdpter.minClearSize=5242880,MiniAdpter.subNativeFiles=null,MiniAdpter.subNativeheads=[],MiniAdpter.subMaps=[],MiniAdpter.AutoCacheDownFile=!1,MiniAdpter.parseXMLFromString=function(value){var rst;value=value.replace(/>\s+</g,"><");try{rst=(new window.Parser.DOMParser).parseFromString(value,"text/xml")}catch(error){throw"需要引入xml解析库文件"}return rst},MiniAdpter.idx=1,__static(MiniAdpter,["nativefiles",function(){return this.nativefiles=["layaNativeDir","wxlocal"]}]),MiniAdpter}(),MiniLoader=function(_super){function MiniLoader(){MiniLoader.__super.call(this)}return __class(MiniLoader,"laya.wx.mini.MiniLoader",EventDispatcher),MiniLoader.prototype.load=function(url,type,cache,group,ignoreCache){void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1);if(this._url=url,url){if(0===(url=URL.customFormat(url)).indexOf("data:image")?this._type=type="image":this._type=type||(type=Loader.getTypeFromUrl(this._url)),this._cache=cache,this._data=null,!ignoreCache&&Loader.loadedMap[URL.formatURL(url)])return this._data=Loader.loadedMap[URL.formatURL(url)],this.event("progress",1),void this.event("complete",this._data);if(null!=Loader.parserMap[type])return this._customParse=!0,void(Loader.parserMap[type]instanceof laya.utils.Handler?Loader.parserMap[type].runWith(this):Loader.parserMap[type].call(null,this));var contentType;switch(type){case"atlas":case"prefab":case"plf":contentType="json";break;case"font":contentType="xml";break;case"plfb":contentType="arraybuffer";break;default:contentType=type}if(Loader.preLoadedMap[URL.formatURL(url)])this.onLoaded(Loader.preLoadedMap[URL.formatURL(url)]);else{var encoding=MiniAdpter.getUrlEncode(url,contentType),urlType=Utils.getFileExtension(url);if(-1!=MiniLoader._fileTypeArr.indexOf(urlType))MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache);else{if(MiniAdpter.isZiYu&&!MiniFileMgr.ziyuFileData[url]&&(url=URL.formatURL(url)),MiniAdpter.isZiYu&&MiniFileMgr.ziyuFileData[url]){var tempData=MiniFileMgr.ziyuFileData[url];return void this.onLoaded(tempData)}if(MiniFileMgr.getFileInfo(url)){var fileObj=MiniFileMgr.getFileInfo(url);fileObj.encoding=null==fileObj.encoding?"utf8":fileObj.encoding,MiniFileMgr.readFile(url,fileObj.encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url)}else{if(MiniFileMgr.isLocalNativeFile(url)){if(MiniAdpter.subNativeFiles&&0==MiniAdpter.subNativeheads.length)for(var key in MiniAdpter.subNativeFiles){var tempArr=MiniAdpter.subNativeFiles[key];MiniAdpter.subNativeheads=MiniAdpter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++)MiniAdpter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa]}if(MiniAdpter.subNativeFiles&&-1!=url.indexOf("/")){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&-1!=MiniAdpter.subNativeheads.indexOf(curfileHead)){var newfileHead=MiniAdpter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead)}}var tempStr=""!=URL.rootPath?URL.rootPath:URL._basePath,tempUrl=url;return""!=tempStr&&(url=url.split(tempStr)[1]),url||(url=tempUrl),void MiniFileMgr.read(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]))}var tempurl=URL.formatURL(url);-1!=tempurl.indexOf("http://usr/")||-1==tempurl.indexOf("http://")&&-1==tempurl.indexOf("https://")||MiniAdpter.AutoCacheDownFile?MiniFileMgr.readFile(url,encoding,new Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[encoding,url,type,cache,group,ignoreCache,this]),url):MiniAdpter.EnvConfig.load.call(this,url,type,cache,group,ignoreCache)}}}}else this.onLoaded(null)},MiniLoader.onReadNativeCallBack=function(encoding,url,type,cache,group,ignoreCache,thisLoader,errorCode,data){var tempData;(void 0===cache&&(cache=!0),void 0===ignoreCache&&(ignoreCache=!1),void 0===errorCode&&(errorCode=0),errorCode)?1==errorCode&&MiniAdpter.EnvConfig.load.call(thisLoader,url,type,cache,group,ignoreCache):(tempData="json"==type||"atlas"==type||"prefab"==type||"plf"==type?MiniAdpter.getJson(data.data):"xml"==type?Utils.parseXMLFromString(data.data):data.data,!MiniAdpter.isZiYu&&MiniAdpter.isPosMsgYu&&"arraybuffer"!=type&&wx.postMessage({url:url,data:tempData,isLoad:"filedata"}),thisLoader.onLoaded(tempData))},__static(MiniLoader,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),MiniLoader}(),MiniSound=function(_super){function MiniSound(){this._sound=null,this.url=null,this.loaded=!1,this.readyUrl=null,MiniSound.__super.call(this)}__class(MiniSound,"laya.wx.mini.MiniSound",EventDispatcher);var __proto=MiniSound.prototype;return __proto.load=function(url){if(MiniFileMgr.isLocalNativeFile(url)){if(-1!=url.indexOf("http://")||-1!=url.indexOf("https://"))if(""!=MiniFileMgr.loadPath)url=url.split(MiniFileMgr.loadPath)[1];else{var tempStr=""!=URL.rootPath?URL.rootPath:URL._basePath;""!=tempStr&&(url=url.split(tempStr)[1])}}else url=URL.formatURL(url);if(this.url=url,this.readyUrl=url,MiniSound._audioCache[this.readyUrl])this.event("complete");else if(MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(url))this.onDownLoadCallBack(url,0);else if(MiniAdpter.autoCacheFile)if(MiniFileMgr.isLocalNativeFile(url)){var tempUrl=url;if(""!=(tempStr=""!=URL.rootPath?URL.rootPath:URL._basePath)&&(url=url.split(tempStr)[1]),url||(url=tempUrl),MiniAdpter.subNativeFiles&&0==MiniAdpter.subNativeheads.length)for(var key in MiniAdpter.subNativeFiles){var tempArr=MiniAdpter.subNativeFiles[key];MiniAdpter.subNativeheads=MiniAdpter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++)MiniAdpter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa]}if(MiniAdpter.subNativeFiles&&-1!=url.indexOf("/")){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&-1!=MiniAdpter.subNativeheads.indexOf(curfileHead)){var newfileHead=MiniAdpter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead)}}this.onDownLoadCallBack(url,0)}else!MiniFileMgr.isLocalNativeFile(url)&&-1==url.indexOf("http://")&&-1==url.indexOf("https://")||-1!=url.indexOf("http://usr/")?this.onDownLoadCallBack(url,0):MiniFileMgr.downOtherFiles(url,Handler.create(this,this.onDownLoadCallBack,[url]),url);else this.onDownLoadCallBack(url,0)},__proto.onDownLoadCallBack=function(sourceUrl,errorCode){if(errorCode)this.event("error");else{var fileNativeUrl;if(MiniAdpter.autoCacheFile){if(MiniFileMgr.isLocalNativeFile(sourceUrl)){var tempStr=""!=URL.rootPath?URL.rootPath:URL._basePath,tempUrl=sourceUrl;""==tempStr||-1==sourceUrl.indexOf("http://")&&-1==sourceUrl.indexOf("https://")||(fileNativeUrl=sourceUrl.split(tempStr)[1]),fileNativeUrl||(fileNativeUrl=tempUrl)}else{var fileObj=MiniFileMgr.getFileInfo(sourceUrl);if(fileObj&&fileObj.md5){var fileMd5Name=fileObj.md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name)}else fileNativeUrl=sourceUrl}this._sound=MiniSound._createSound(),this._sound.src=this.url=fileNativeUrl}else this._sound=MiniSound._createSound(),this._sound.src=sourceUrl;this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this)),this._sound.onError(MiniSound.bindToThis(this.onError,this))}},__proto.onError=function(error){try{console.log("-----1---------------minisound-----id:"+MiniSound._id),console.log(error)}catch(error){console.log("-----2---------------minisound-----id:"+MiniSound._id),console.log(error)}this.event("error"),this._sound.offError(null)},__proto.onCanPlay=function(){this.loaded=!0,this.event("complete"),this._sound.offCanplay(null)},__proto.play=function(startTime,loops){var tSound;if(void 0===startTime&&(startTime=0),void 0===loops&&(loops=0),this.url==SoundManager._bgMusic?(MiniSound._musicAudio||(MiniSound._musicAudio=MiniSound._createSound()),tSound=MiniSound._musicAudio):tSound=MiniSound._audioCache[this.readyUrl]?MiniSound._audioCache[this.readyUrl]._sound:MiniSound._createSound(),!tSound)return null;if(MiniAdpter.autoCacheFile&&MiniFileMgr.getFileInfo(this.url)){var fileMd5Name=MiniFileMgr.getFileInfo(this.url).md5;tSound.src=this.url=MiniFileMgr.getFileNativePath(fileMd5Name)}else tSound.src=this.url;var channel=new MiniSoundChannel(tSound,this);return channel.url=this.url,channel.loops=loops,channel.loop=0===loops,channel.startTime=startTime,channel.play(),SoundManager.addChannel(channel),channel},__proto.dispose=function(){var ad=MiniSound._audioCache[this.readyUrl];ad&&(ad.src="",ad._sound&&(ad._sound.destroy(),ad._sound=null,ad=null),delete MiniSound._audioCache[this.readyUrl])},__getset(0,__proto,"duration",function(){return this._sound.duration}),MiniSound._createSound=function(){return MiniSound._id++,MiniAdpter.window.wx.createInnerAudioContext()},MiniSound.bindToThis=function(fun,scope){return fun.bind(scope)},MiniSound._musicAudio=null,MiniSound._id=0,MiniSound._audioCache={},MiniSound}(),MiniSoundChannel=(function(_super){function MiniAccelerator(){MiniAccelerator.__super.call(this)}__class(MiniAccelerator,"laya.wx.mini.MiniAccelerator",_super);var __proto=MiniAccelerator.prototype;__proto.on=function(type,caller,listener,args){return _super.prototype.on.call(this,type,caller,listener,args),MiniAccelerator.startListen(this.onDeviceOrientationChange),this},__proto.off=function(type,caller,listener,onceOnly){return void 0===onceOnly&&(onceOnly=!1),this.hasListener(type)||MiniAccelerator.stopListen(),_super.prototype.off.call(this,type,caller,listener,onceOnly)},MiniAccelerator.__init__=function(){try{var Acc;if(!(Acc=laya.device.motion.Accelerator))return;Acc.prototype.on=MiniAccelerator.prototype.on,Acc.prototype.off=MiniAccelerator.prototype.off}catch(e){}},MiniAccelerator.startListen=function(callBack){if(MiniAccelerator._callBack=callBack,!MiniAccelerator._isListening){MiniAccelerator._isListening=!0;try{wx.onAccelerometerChange(MiniAccelerator.onAccelerometerChange)}catch(e){}}},MiniAccelerator.stopListen=function(){MiniAccelerator._isListening=!1;try{wx.stopAccelerometer({})}catch(e){}},MiniAccelerator.onAccelerometerChange=function(res){var e;(e={}).acceleration=res,e.accelerationIncludingGravity=res,e.rotationRate={},null!=MiniAccelerator._callBack&&MiniAccelerator._callBack(e)},MiniAccelerator._isListening=!1,MiniAccelerator._callBack=null}(EventDispatcher),function(_super){function MiniSoundChannel(audio,miniSound){this._audio=null,this._onEnd=null,this._miniSound=null,MiniSoundChannel.__super.call(this),this._audio=audio,this._miniSound=miniSound,this._onEnd=MiniSoundChannel.bindToThis(this.__onEnd,this),audio.onEnded(this._onEnd)}__class(MiniSoundChannel,"laya.wx.mini.MiniSoundChannel",SoundChannel);var __proto=MiniSoundChannel.prototype;return __proto.__onEnd=function(){if(MiniSound._audioCache[this.url]=this._miniSound,1==this.loops)return this.completeHandler&&(Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},__proto.play=function(){this.isStopped=!1,SoundManager.addChannel(this),this._audio.play()},__proto.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.offEnded(null),this._miniSound.dispose(),this._audio=null,this._miniSound=null,this._onEnd=null)},__proto.pause=function(){this.isStopped=!0,this._audio.pause()},__proto.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),this._audio.play())},__getset(0,__proto,"startTime",null,function(time){this._audio&&(this._audio.startTime=time)}),__getset(0,__proto,"autoplay",function(){return this._audio.autoplay},function(value){this._audio.autoplay=value}),__getset(0,__proto,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,__proto,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,__proto,"loop",function(){return this._audio.loop},function(value){this._audio.loop=value}),__getset(0,__proto,"volume",function(){return this._audio?this._audio.volume:1},function(v){this._audio&&(this._audio.volume=v)}),MiniSoundChannel.bindToThis=function(fun,scope){return fun.bind(scope)},MiniSoundChannel}())},1e3);